<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>个人中心</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="js/cropper/cropper.min.css">
    <link rel="stylesheet" href="css/iconfont.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body class="bg-f5f5f5">
    <div class="page-header">
        <div class="md2018101001lty">
            <div class="container">
                <div class="left-nav pull-left">
                    <span>亲爱的，欢迎来到爱包包</span>
                    <a href="#">请登录</a>
                    <a href="#">免费注册</a>
                </div>
                <ul class="right-list pull-right clearfix">
                    <li><a href="#">我的订单</a></li>
                    <li>
                        <a href="#">
                            <i class="abb-icon shoppings-cart"></i>
                            <span>购物车<i class="nums">0</i>件</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">收藏夹</a>
                    </li>
                    <li>|</li>
                    <li>
                        <a href="#">
                            <i class="abb-icon phone"></i>
                            <span>手机版</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="page-body">
        <div class="container md-2018101101-xxw">
            <div class="pull-left l-cont">
                <div class="pic-box">
                    <img src="images/bags-example.jpg">
                </div>
                <ul class="list-grpup">
                    <li class="cur"><a href="javascript:;">个人资料</a></li>
                    <li><a href="user-address.html">收货地址</a></li>
                    <li><a href="buied-goods.html">已买到的宝贝</a></li>
                </ul>
            </div>
            <div class="pull-left r-cont bg-f5f5f5">
                <div class="md-cont md-2018101202-xxw" id="md_2018102401_lty">
                    <div class="input-group ">
                        <p class="input-tit pl-11">当前头像</p>
                        <img id="js_open_pic" class="" src="images/bags-example.jpg">
                    </div>
                    <div class="input-group">
                        <p class="input-tit"><span>*</span>昵称</p>
                        <input placeholder="请输入昵称" type="text" cusrule="nickname">
                        <span class="error-msg">请输入4~12位的中文、字母、数字、下划线</span>
                    </div>
                    <div class="input-group">
                        <p class="input-tit">真实姓名</p>
                        <input placeholder="请输入真实姓名" type="text">
                    </div>
                    <div class="input-group">
                        <p class="input-tit"><span>*</span>性别</p>
                        <input placeholder="男/女" type="text" cusrule="required">
                        <span class="error-msg">必填</span>
                    </div>
                    <div class="input-group">
                        <input class="text-center btn-black" type="button" value="保存" id="js_update_info">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="page-footer">
        <div class="md2018101002lty">
            <div class="container">
                <div class="footer-item">
                    <h3>专属服务</h3>
                    <ul>
                        <li><a href="#">免费标准配送</a></li>
                        <li><a href="#">免费礼品包装</a></li>
                    </ul>
                </div>
                <div class="footer-item">
                    <h3>购物帮助</h3>
                    <ul>
                        <li><a href="#">支付相关</a></li>
                        <li><a href="#">配送</a></li>
                        <li><a href="#">退货</a></li>
                        <li><a href="#">发票</a></li>
                        <li><a href="#">保养与维修</a></li>
                    </ul>
                </div>
                <div class="footer-item">
                    <h3>关于公司</h3>
                    <ul>
                        <li><a href="#">关于爱包包</a></li>
                        <li><a href="#">LOVEBAG</a></li>
                        <li><a href="#">职业发展</a></li>
                        <li><a href="#">细则及条款</a></li>
                        <li><a href="#">隐私与条款</a></li>
                        <li><a href="#">企业信息</a></li>
                    </ul>
                </div>
                <div class="footer-item">
                    <h3>关注爱包包</h3>
                    <ul>
                        <li><a href="#">微信</a></li>
                        <li><a href="#">微博</a></li>
                        <li><a href="#">优酷</a></li>
                    </ul>
                </div>
                <div class="footer-item">
                    <h3>在线顾问</h3>
                    <ul>
                        <li><a href="#">400.400.400</a></li>
                    </ul>
                </div>
                <div class="footer-item">
                    <h3>需要帮助</h3>
                    <ul>
                        <li><a href="#">联系我们</a></li>
                        <li><a href="#">常见问题</a></li>
                    </ul>
                </div>
                <div class="foot-logo">
                    <img src="css/img/icon2018101001lty.png" alt="">
                    <p>©2018 爱包包（中国）贸易有限公司 保留所有权利</p>
                </div>
            </div>
        </div>
    </div>
    <div style="display: none;">
        <div id="js_user_mask" class="set-20180409-ccj">
            <div class="user-mask">
                <span class="js-closewin-btn close"><i class="cusfont cusfont-close font-14"></i></span>
                <div id="js_img_div" class="img-area">
                    <img/>
                </div>
                <p class="text-center">支持：300KB 以内的 *.jpg、*.png 格式的图片</p>
                <div class="btn-area text-center">
                    <div class="form-btn-inp">
                        <button class="form-btn form-btn-blue" type="button">选择</button>
                        <input class="selec-but" id="selectImg" type="file" />
                    </div>
                    <!--<button id="resetImg" class="form-btn form-btn-blue" type="button" disabled="disabled">重置</button>-->
                    <button id="js_upImg" class="form-btn form-btn-blue" type="button" disabled="disabled">上传</button>
                </div>
            </div>
        </div>
    </div>
    <!--头像上传弹窗 end-->
    <script src="js/jquery-2.1.1.js"></script>
    <script src="js/colorbox/jquery.colorbox-min.js"></script>
    <script src="js/cropper/cropper.min.js"></script>
    <script src="js/main.js"></script>
    <script>

        $(function(){
            
            //更新个人信息
            $('#js_update_info').click(function(){
               if(validateForm('md_2018102401_lty').form()){
                    alert('验证通过');
                }
            });

            // 上传方法
            var _imgObj = $('#js_img_div>img');
            var cp_opt = {
                    aspectRatio: 1 / 1,
                    //preview: '.img-preview',
                    //background:false,
                    guides: false,
                    autoCropArea: 0.6,
                    fileSize: 1024 * 300
                    //touchDragZoom: false
                },
                _imgType = 'images/jpeg',
                _imgTypeReg = /(image\/jpeg)|(image\/png)/;
            var cutUpImg = {
                changeImg: function(evt) {
                    var file_ = this.files[0],
                        URL_ = window.URL || window.webkitURL,
                        _blobURL,
                        objURL_;

                    if(file_) {
                        if(file_.size > cp_opt.fileSize){
                            alert('图片大小超出限制');
                            return false;
                        }

                        $('#resetImg,#js_upImg').removeAttr('disabled');
                        _imgType = file_.type;
                        if(_imgTypeReg.test(file_.type)) {
                            if(URL_) { //兼容ie10
                                if(objURL_) {
                                    URL_.revokeObjectURL(objURL_);
                                }

                                objURL_ = URL_.createObjectURL(file_);
                            } else {
                                alert('该浏览器，暂不支持URL!');
                                return false;
                            }
                            _imgObj.cropper('destroy').attr('src', objURL_).cropper(cp_opt);
                        } else {
                            alert('请选择jpg/png格式图片!');
                        }
                    }
                    $(this).val('');
                },
                resetImg: function(evt) {
                    _imgObj.cropper('destroy').attr('src', '');
                    $(this).attr({
                        'disabled': 'disabled'
                    });
                    $('#js_upImg').attr({
                        'disabled': 'disabled'
                    });
                },
                upImg: function(callback) {
                    $(this).attr({
                        'disabled': 'disabled'
                    });
                    var cvsData = _imgObj.cropper('getCroppedCanvas');
                    var newbase64 = cvsData.toDataURL(_imgType, 1).split(',')[1];
                    $.ajax({
                        type: 'POST',
                        url: UC_PATH_ +'/userCenter/uploadHeandImg',
                        data: {
                            'fbase64': newbase64
                        },
                        success: function(res) {
                            $(this).removeAttr('disabled');
                            //TODO
                            callback && callback(res);
                        }
                    });
                }
            };
            $('#js_open_pic').click(function(){
                $.colorbox({
                    speed: 0,
                    inline: true,
                    overlayClose: false,
                    close: false,
                    href: "#js_user_mask",
                    onClosed: function(){
                        cutUpImg.resetImg();
                    }
                });
            });
            $('#selectImg').on('change', cutUpImg.changeImg);
            $('#js_upImg').on('click', function(){
                cutUpImg.upImg(function(res){
                    if(res.code == 1){
                        alert('上传成功');
                        // res.obj

                        _imgObj.cropper('destroy').attr('src', '');
                        $('#js_open_pic img').attr('src', res.obj);
                        $('#js_img_src').val(res.obj);
                        $.colorbox && $.colorbox.close();
                    }else{
                        alert('上传失败');
                    }
                });
            });
        })
    </script>
</body>

</html>
